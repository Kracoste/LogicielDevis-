<!DOCTYPE html>
<html>
<head>
    <title>Test R√©capitulatif</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .service-line { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .recap-section { margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px; }
        input { padding: 5px; margin: 5px; width: 100px; }
        button { padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 4px; }
        .totals { font-size: 18px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test du Syst√®me de R√©capitulatif</h1>
        
        <div class="service-line">
            <label>Service 1:</label>
            <input type="number" name="service_price" placeholder="Prix" value="100">
            <input type="number" name="service_quantity" placeholder="Quantit√©" value="1">
        </div>
        
        <div class="service-line">
            <label>Service 2:</label>
            <input type="number" name="service_price" placeholder="Prix" value="50">
            <input type="number" name="service_quantity" placeholder="Quantit√©" value="2">
        </div>
        
        <div class="service-line">
            <label>Service 3:</label>
            <input type="number" name="service_price" placeholder="Prix" value="">
            <input type="number" name="service_quantity" placeholder="Quantit√©" value="">
        </div>
        
        <button onclick="calculerTotaux()">Calculer manuellement</button>
        
        <div class="recap-section">
            <h3>R√©capitulatif</h3>
            <div class="totals">
                <p>Sous-total HT: <span id="subtotalHT">0.00‚Ç¨</span></p>
                <p>TVA (20%): <span id="taxAmount">0.00‚Ç¨</span></p>
                <p>Total TTC: <span id="totalTTC">0.00‚Ç¨</span></p>
            </div>
        </div>
    </div>

    <script>
        console.log('üß™ [TEST] Script de test charg√©');
        
        // Fonction pour calculer les totaux
        function calculerTotaux() {
            console.log('üí∞ [RECAP] === CALCUL DES TOTAUX ===');
            
            // R√©cup√©rer tous les champs de prix et quantit√©
            const priceInputs = document.querySelectorAll('input[name="service_price"]');
            const quantityInputs = document.querySelectorAll('input[name="service_quantity"]');
            
            console.log(`üí∞ [RECAP] Champs prix trouv√©s: ${priceInputs.length}`);
            console.log(`üí∞ [RECAP] Champs quantit√© trouv√©s: ${quantityInputs.length}`);
            
            let subtotalHT = 0;
            
            // Calculer le sous-total HT
            priceInputs.forEach((priceInput, index) => {
                const price = parseFloat(priceInput.value) || 0;
                const quantityInput = quantityInputs[index];
                const quantity = quantityInput ? (parseFloat(quantityInput.value) || 1) : 1;
                
                const lineTotal = price * quantity;
                subtotalHT += lineTotal;
                
                console.log(`üí∞ [RECAP] Ligne ${index + 1}: ${price}‚Ç¨ √ó ${quantity} = ${lineTotal}‚Ç¨`);
            });
            
            // Calcul de la TVA (20%)
            const tauxTVA = 0.20;
            const montantTVA = subtotalHT * tauxTVA;
            const totalTTC = subtotalHT + montantTVA;
            
            console.log(`üí∞ [RECAP] Sous-total HT: ${subtotalHT.toFixed(2)}‚Ç¨`);
            console.log(`üí∞ [RECAP] TVA (20%): ${montantTVA.toFixed(2)}‚Ç¨`);
            console.log(`üí∞ [RECAP] Total TTC: ${totalTTC.toFixed(2)}‚Ç¨`);
            
            // Mettre √† jour l'affichage
            document.getElementById('subtotalHT').textContent = subtotalHT.toFixed(2) + '‚Ç¨';
            document.getElementById('taxAmount').textContent = montantTVA.toFixed(2) + '‚Ç¨';
            document.getElementById('totalTTC').textContent = totalTTC.toFixed(2) + '‚Ç¨';
            
            console.log('‚úÖ [RECAP] Affichage mis √† jour');
        }
        
        // Ajouter des √©couteurs d'√©v√©nements
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ [TEST] DOM charg√© - Ajout des √©couteurs');
            
            const priceInputs = document.querySelectorAll('input[name="service_price"]');
            const quantityInputs = document.querySelectorAll('input[name="service_quantity"]');
            
            // √âcouteurs pour les prix
            priceInputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    console.log(`üí∞ [RECAP] Prix modifi√© (ligne ${index + 1}):`, this.value);
                    calculerTotaux();
                });
            });
            
            // √âcouteurs pour les quantit√©s
            quantityInputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    console.log(`üí∞ [RECAP] Quantit√© modifi√©e (ligne ${index + 1}):`, this.value);
                    calculerTotaux();
                });
            });
            
            // Calcul initial
            calculerTotaux();
            
            console.log('‚úÖ [TEST] Syst√®me de r√©capitulatif initialis√©');
        });
    </script>
</body>
</html>
