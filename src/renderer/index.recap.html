<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test R√©capitulatif</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6">
        <h1 class="text-2xl font-bold mb-6">Test du R√©capitulatif Automatique</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-lg font-semibold mb-4">Prestations</h2>
            
            <!-- Prestation 1 -->
            <div class="flex gap-4 mb-4">
                <input 
                    type="text" 
                    value="D√©veloppement web" 
                    class="flex-1 px-3 py-2 border rounded"
                    placeholder="Description"
                />
                <input 
                    type="number" 
                    name="service_quantity[]" 
                    value="1" 
                    class="w-20 px-3 py-2 border rounded text-center"
                    min="1"
                />
                <input 
                    type="number" 
                    name="service_price[]" 
                    value="500" 
                    class="w-24 px-3 py-2 border rounded text-right"
                    step="0.01"
                    min="0"
                />
            </div>
            
            <!-- Prestation 2 -->
            <div class="flex gap-4 mb-4">
                <input 
                    type="text" 
                    value="Formation" 
                    class="flex-1 px-3 py-2 border rounded"
                    placeholder="Description"
                />
                <input 
                    type="number" 
                    name="service_quantity[]" 
                    value="2" 
                    class="w-20 px-3 py-2 border rounded text-center"
                    min="1"
                />
                <input 
                    type="number" 
                    name="service_price[]" 
                    value="200" 
                    class="w-24 px-3 py-2 border rounded text-right"
                    step="0.01"
                    min="0"
                />
            </div>
        </div>
        
        <!-- R√©capitulatif -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-4">R√©capitulatif</h2>
            
            <div class="space-y-2">
                <div class="flex justify-between">
                    <span>Total HT :</span>
                    <span id="subtotalHT" class="font-semibold">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between">
                    <span>TVA (20%) :</span>
                    <span id="taxAmount" class="font-semibold">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-lg font-bold border-t pt-2">
                    <span>Total TTC :</span>
                    <span id="totalTTC">0,00 ‚Ç¨</span>
                </div>
            </div>
        </div>
        
        <div class="mt-6">
            <button onclick="calculerTotaux()" class="bg-blue-500 text-white px-4 py-2 rounded">
                Recalculer
            </button>
        </div>
    </div>

    <script>
        console.log('üöÄ [RECAP-TEST] Page de test charg√©e');
        
        function calculerTotaux() {
            console.log('üí∞ [RECAP-TEST] Calcul des totaux...');
            
            let totalHT = 0;
            
            // Chercher tous les champs prix et quantit√©
            const priceInputs = document.querySelectorAll('input[name="service_price[]"]');
            const qtyInputs = document.querySelectorAll('input[name="service_quantity[]"]');
            
            console.log('üìù [RECAP-TEST] Prix trouv√©s:', priceInputs.length, 'Quantit√©s:', qtyInputs.length);
            
            for (let i = 0; i < priceInputs.length && i < qtyInputs.length; i++) {
                const prix = parseFloat(priceInputs[i].value) || 0;
                const qty = parseFloat(qtyInputs[i].value) || 0;
                const subtotal = prix * qty;
                
                if (subtotal > 0) {
                    totalHT += subtotal;
                    console.log(`üí∞ [RECAP-TEST] Prestation ${i+1}: ${qty} x ${prix}‚Ç¨ = ${subtotal.toFixed(2)}‚Ç¨`);
                }
            }
            
            const tva = totalHT * 0.20;
            const totalTTC = totalHT + tva;
            
            console.log(`üìä [RECAP-TEST] TOTAUX - HT: ${totalHT.toFixed(2)}‚Ç¨ | TVA: ${tva.toFixed(2)}‚Ç¨ | TTC: ${totalTTC.toFixed(2)}‚Ç¨`);
            
            // Mettre √† jour l'affichage
            const htElement = document.getElementById('subtotalHT');
            const tvaElement = document.getElementById('taxAmount');
            const ttcElement = document.getElementById('totalTTC');
            
            if (htElement) {
                htElement.textContent = totalHT.toFixed(2) + ' ‚Ç¨';
                console.log('‚úÖ [RECAP-TEST] HT mis √† jour');
            }
            if (tvaElement) {
                tvaElement.textContent = tva.toFixed(2) + ' ‚Ç¨';
                console.log('‚úÖ [RECAP-TEST] TVA mise √† jour');
            }
            if (ttcElement) {
                ttcElement.textContent = totalTTC.toFixed(2) + ' ‚Ç¨';
                console.log('‚úÖ [RECAP-TEST] TTC mis √† jour');
            }
        }
        
        // Installer les √©v√©nements
        function installerEvenements() {
            console.log('üéØ [RECAP-TEST] Installation des √©v√©nements...');
            
            document.addEventListener('input', function(event) {
                if (event.target.name === 'service_price[]' || event.target.name === 'service_quantity[]') {
                    console.log('üìù [RECAP-TEST] Input modifi√©:', event.target.name, '=', event.target.value);
                    setTimeout(calculerTotaux, 50);
                }
            });
            
            console.log('‚úÖ [RECAP-TEST] √âv√©nements install√©s');
            calculerTotaux(); // Calcul initial
        }
        
        // S'assurer que les √©v√©nements sont install√©s
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', installerEvenements);
        } else {
            installerEvenements();
        }
        
        console.log('‚úÖ [RECAP-TEST] Syst√®me configur√©');
    </script>
</body>
</html>
