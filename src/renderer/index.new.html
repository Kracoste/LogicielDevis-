<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Logiciel de Devis</title>
	<link rel="stylesheet" href="styles/output.css">
	<style>
		.drag-region {
			-webkit-app-region: drag;
		}
		.no-drag {
			-webkit-app-region: no-drag;
		}
		.sidebar-item {
			display: flex;
			align-items: center;
			width: 100%;
			padding: 12px 16px;
			text-align: left;
			color: #374151;
			background: transparent;
			border: none;
			border-radius: 8px;
			transition: all 0.2s;
			cursor: pointer;
		}
		.sidebar-item:hover {
			background-color: #f3f4f6;
		}
		.sidebar-item.active {
			background-color: #eff6ff;
			color: #2563eb;
			border-right: 2px solid #2563eb;
		}
		.tab-content {
			display: none;
		}
		.tab-content.active {
			display: block;
		}
		
		/* CSS FORÇANT LA VUE NOUVEAU DEVIS À PRENDRE TOUT L'ÉCRAN */
		#newQuoteView {
			position: fixed !important;
			top: 0 !important;
			left: 0 !important;
			right: 0 !important;
			bottom: 0 !important;
			width: 100vw !important;
			height: 100vh !important;
			margin: 0 !important;
			padding: 0 !important;
			z-index: 9999 !important;
			background-color: #f3f4f6 !important;
			overflow-y: auto !important;
		}
		
		#newQuoteView .min-h-screen {
			min-height: 100vh !important;
			width: 100% !important;
		}
		
		/* Bouton retour - STYLE SIMPLE SANS CARRÉ - ZONE CLIQUABLE AGRANDIE */
		#backToQuotesBtn {
			transition: all 0.2s ease !important;
			cursor: pointer !important;
			user-select: none !important;
			-webkit-user-select: none !important;
			-moz-user-select: none !important;
			-ms-user-select: none !important;
			color: #374151 !important;
			font-weight: 600 !important;
			font-size: 18px !important;
			padding: 12px 16px !important;
			border-radius: 6px !important;
			display: flex !important;
			align-items: center !important;
			gap: 8px !important;
			min-height: 44px !important;
			min-width: 120px !important;
			box-sizing: border-box !important;
			position: relative !important;
		}
		
		#backToQuotesBtn:hover {
			color: #111827 !important;
			background-color: rgba(243, 244, 246, 0.8) !important;
			transform: translateX(-2px) !important;
		}
		
		#backToQuotesBtn:active {
			transform: translateX(0) !important;
			background-color: rgba(229, 231, 235, 0.8) !important;
		}
	</style>
</head>
<body class="bg-gray-50 h-screen">
	<!-- Barre de titre personnalisée -->
	<div class="drag-region h-12 bg-white border-b border-gray-200 flex items-center justify-between px-4">
        <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </div>
            <span class="font-semibold text-gray-900">Logiciel de Devis</span>
        </div>
        
        <div class="no-drag flex items-center space-x-2">
            <button id="minimizeBtn" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                </svg>
            </button>
            <button id="maximizeBtn" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                </svg>
            </button>
            <button id="closeBtn" class="p-2 hover:bg-red-100 hover:text-red-600 rounded-lg transition-colors">
                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Contenu principal -->
    <div class="flex h-[calc(100vh-3rem)]">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <!-- User info -->
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <span id="userInitials" class="text-blue-600 font-semibold text-sm">U</span>
                    </div>
                    <div>
                        <div id="userName" class="font-medium text-gray-900">Utilisateur</div>
                        <div id="userCompany" class="text-sm text-gray-600">Mon Entreprise</div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-2">
                <button class="sidebar-item active" data-tab="dashboard">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6a2 2 0 01-2 2H10a2 2 0 01-2-2V5z"></path>
                    </svg>
                    <span>Tableau de bord</span>
                </button>

                <button class="sidebar-item" data-tab="quotes">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span>Devis</span>
                    <span id="quotesCount" class="ml-auto px-2 py-1 text-xs bg-blue-100 text-blue-600 rounded-full">0</span>
                </button>

                <button class="sidebar-item" data-tab="clients">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>Clients</span>
                    <span id="clientsCount" class="ml-auto px-2 py-1 text-xs bg-green-100 text-green-600 rounded-full">0</span>
                </button>

                <button class="sidebar-item" data-tab="settings">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>Paramètres</span>
                </button>
            </nav>

            <!-- Logout -->
            <div class="p-4 border-t border-gray-200">
                <button id="logoutBtn" class="w-full flex items-center justify-center space-x-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span>Déconnexion</span>
                </button>
            </div>
        </aside>

        <!-- Main content -->
        <main class="flex-1 overflow-auto">
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active p-6">
                <h1 class="text-2xl font-bold text-gray-900 mb-6">Tableau de bord</h1>
                
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Devis Card -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 uppercase tracking-wide">Devis</p>
                                <p id="totalQuotes" class="text-2xl font-semibold text-gray-900">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Clients Card -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 uppercase tracking-wide">Clients</p>
                                <p id="totalClients" class="text-2xl font-semibold text-gray-900">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- CA Card -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 uppercase tracking-wide">Chiffre d'affaires</p>
                                <p id="totalCA" class="text-2xl font-semibold text-gray-900">0 €</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Bénéfice Card -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 uppercase tracking-wide">Bénéfice</p>
                                <p id="totalBenefit" class="text-2xl font-semibold text-gray-900">0 €</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quotes Tab -->
            <div id="quotesTab" class="tab-content p-6">
                <div class="flex items-center justify-between mb-6">
                    <h1 class="text-2xl font-bold text-gray-900">Devis</h1>
                    <button id="createQuoteBtn" class="bg-white hover:bg-gray-50 text-black border-2 border-gray-300 px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Nouveau Devis</span>
                    </button>
                </div>

                <!-- Quotes List -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Liste des devis</h3>
                        <div id="quotesList" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <p>Aucun devis créé pour le moment.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clients Tab -->
            <div id="clientsTab" class="tab-content p-6">
                <h1 class="text-2xl font-bold text-gray-900 mb-6">Clients</h1>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="p-6">
                        <p class="text-gray-500">Section clients en construction...</p>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content p-6">
                <h1 class="text-2xl font-bold text-gray-900 mb-6">Paramètres</h1>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="p-6">
                        <p class="text-gray-500">Section paramètres en construction...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Vue Création de Devis - LAYOUT ÉQUILIBRÉ -->
    <div id="newQuoteView" class="hidden" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; width: 100vw !important; height: 100vh !important; background-color: #f8fafc !important; z-index: 9999 !important; overflow-y: auto !important;">
        <div style="min-height: 100vh !important; width: 100% !important; padding: 1rem; max-width: 1100px; margin: 0 auto;">
            <!-- Header équilibré -->
            <div class="flex items-center justify-between mb-4 bg-white rounded-lg shadow-sm p-3 border">
                <div class="flex items-center space-x-4">
                    <div id="backToQuotesBtn">← Retour</div>
                    <h1 class="text-xl font-bold text-gray-900">Nouveau Devis</h1>
                </div>
                <button id="saveQuoteBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    Enregistrer
                </button>
            </div>

            <!-- Formulaire équilibré -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="p-4">
                    <form id="newQuoteForm" class="space-y-5">
                        <!-- Informations client - Layout équilibré -->
                        <div class="space-y-3">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                <div>
                                    <label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">Client *</label>
                                    <input type="text" id="clientName" name="clientName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                </div>
                                <div>
                                    <label for="clientEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input type="email" id="clientEmail" name="clientEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                </div>
                                <div>
                                    <label for="clientPhone" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                                    <input type="tel" id="clientPhone" name="clientPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                </div>
                                <div>
                                    <label for="quoteDate" class="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                                    <input type="date" id="quoteDate" name="quoteDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                </div>
                            </div>
                            <div>
                                <label for="clientAddress" class="block text-sm font-medium text-gray-700 mb-1">Adresse du client</label>
                                <textarea id="clientAddress" name="clientAddress" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"></textarea>
                            </div>
                        </div>

                        <!-- Prestations équilibrées -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Prestations
                                </h3>
                                <button type="button" id="addServiceBtn" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Ajouter une prestation
                                </button>
                            </div>
                            <!-- Section prestations avec design en ligne -->
                            <div id="servicesContainerFullPage" class="space-y-3">
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border shadow-sm">
                                    <div class="flex-1">
                                        <label class="block text-xs font-medium text-gray-600 mb-1">Description de la prestation</label>
                                        <input type="text" name="service_description[]" placeholder="Décrivez votre prestation..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm" required>
                                    </div>
                                    <div class="w-16">
                                        <label class="block text-xs font-medium text-gray-600 mb-1">Quantité</label>
                                        <input type="number" name="service_quantity[]" min="1" value="1" class="w-full px-2 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-center" required>
                                    </div>
                                    <div class="w-28">
                                        <label class="block text-xs font-medium text-gray-600 mb-1">Prix HT</label>
                                        <input type="number" name="service_price[]" step="0.01" min="0" placeholder="0.00 €" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-right" required>
                                    </div>
                                    <div class="flex items-end">
                                        <button type="button" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" onclick="this.closest('.flex.items-center').remove(); updateTotal();" title="Supprimer cette prestation">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Layout 2 colonnes: Notes à gauche, Total à droite -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Notes (colonne gauche) -->
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="block text-sm font-medium text-gray-700">Notes et conditions</label>
                                        <button type="button" id="addServiceBtnNotes" class="inline-flex items-center px-3 py-1 text-sm text-black hover:text-gray-600 transition-colors">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Ajouter une prestation
                                        </button>
                                    </div>
                                    <textarea name="quote_notes" rows="4" placeholder="Ajouter des notes ou conditions particulières..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Date d'échéance</label>
                                        <input type="date" name="quote_due_date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Validité (jours)</label>
                                        <input type="number" name="quote_validity" value="30" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Récapitulatif des totaux (colonne droite) -->
                            <div class="bg-gray-50 p-6 rounded-lg border">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Récapitulatif</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Sous-total HT</span>
                                        <span id="subtotalHT" class="font-medium">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-600">TVA</span>
                                        <div class="flex items-center gap-2">
                                            <select name="quote_tax_rate" id="taxRateSelect" class="px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500" onchange="updateTotal()">
                                                <option value="20">20%</option>
                                                <option value="10">10%</option>
                                                <option value="5.5">5.5%</option>
                                                <option value="0">0%</option>
                                            </select>
                                            <span id="taxAmount" class="font-medium">0,00 €</span>
                                        </div>
                                    </div>
                                    <div class="border-t pt-3">
                                        <div class="flex justify-between text-lg font-semibold text-gray-900">
                                            <span>Total TTC</span>
                                            <span id="totalTTC" class="text-blue-600">0,00 €</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Boutons d'action -->
                        <div class="flex justify-end items-center pt-6 border-t">
                            <button type="button" id="saveQuoteBtnMain" class="inline-flex items-center px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                                </svg>
                                Enregistrer et générer PDF
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>>

    <!-- ANCIENNE MODAL SUPPRIMÉE - UTILISATION UNIQUEMENT DE LA VUE PLEIN ÉCRAN -->
    <!-- La modal quoteModal a été complètement supprimée pour éviter les conflits avec la vue plein écran -->

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/supabase.min.js"></script>
    <script src="js/init.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // ==========================================
        // FONCTION DE TEST SIMPLE (disponible immédiatement)
        // ==========================================
        window.testSaveFunction = function() {
            alert('🔥 TEST: La fonction JavaScript fonctionne !');
            console.log('🔥 TEST: Bouton de test cliqué !');
            
            // Test de collecte des données du formulaire
            const form = document.getElementById('newQuoteForm');
            if (!form) {
                alert('❌ ERREUR: Formulaire non trouvé');
                return;
            }
            
            console.log('✅ Formulaire trouvé:', form);
            
            // Test de collecte des services
            const services = document.querySelectorAll('#servicesContainerFullPage > div');
            console.log('📊 Services trouvés:', services.length);
            
            if (services.length === 0) {
                alert('⚠️ Aucune ligne de service trouvée. Ajoutez une prestation d\'abord !');
                return;
            }
            
            // Collecter les données du premier service
            const firstService = services[0];
            const description = firstService.querySelector('textarea[name="service_description[]"]')?.value || firstService.querySelector('input[name="service_description[]"]')?.value;
            const quantity = firstService.querySelector('input[name="service_quantity[]"]')?.value;
            const price = firstService.querySelector('input[name="service_price[]"]')?.value;
            
            console.log('📊 Premier service:', {description, quantity, price});
            
            if (!description || !quantity || !price) {
                alert('⚠️ Veuillez remplir au moins une prestation complète (description, quantité, prix)');
                return;
            }
            
            alert(`✅ Test réussi ! Service trouvé: "${description}" - Qté: ${quantity} - Prix: ${price}€`);
            
            // Maintenant essayer la vraie sauvegarde
            if (confirm('Voulez-vous essayer de sauvegarder ce devis ?')) {
                // Appeler la fonction réelle de sauvegarde
                if (window.handleSaveQuote) {
                    const btn = document.getElementById('saveQuoteBtnMain');
                    window.handleSaveQuote(btn);
                } else {
                    alert('❌ Fonction de sauvegarde non trouvée');
                }
            }
        };
        
        // Navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 [MAIN WINDOW] Initialisation de la navigation...');
            
            // ==========================================
            // FONCTION DE FERMETURE ABSOLUE NOUVEAU DEVIS - VERSION RADICALE
            // ==========================================
            function closeNewQuoteViewCompletely() {
                console.log('🚫 FERMETURE ABSOLUE - Nouveau Devis - VERSION RADICALE');
                
                // 1. Masquer la vue avec toutes les méthodes possibles
                const newQuoteView = document.getElementById('newQuoteView');
                if (newQuoteView) {
                    newQuoteView.classList.add('hidden');
                    newQuoteView.style.display = 'none !important';
                    newQuoteView.style.visibility = 'hidden !important';
                    newQuoteView.style.opacity = '0 !important';
                    newQuoteView.style.zIndex = '-9999 !important';
                    newQuoteView.style.position = 'absolute !important';
                    newQuoteView.style.left = '-9999px !important';
                    newQuoteView.style.top = '-9999px !important';
                    newQuoteView.style.width = '0 !important';
                    newQuoteView.style.height = '0 !important';
                    newQuoteView.style.overflow = 'hidden !important';
                    newQuoteView.style.pointerEvents = 'none !important';
                    console.log('✅ Vue nouveau devis BRUTALEMENT masquée');
                }
                
                // 2. FORCER la fermeture de tout onglet qui pourrait exister
                try {
                    // Fermer tous les onglets potentiels dans l'historique
                    if (window.history && window.history.length > 1) {
                        console.log('🔄 Nettoyage historique navigateur');
                        window.history.back();
                        setTimeout(() => {
                            window.history.forward();
                        }, 10);
                    }
                } catch(e) {
                    console.log('⚠️ Pas d\'historique à nettoyer');
                }
                
                // 3. Réinitialiser TOUS les onglets de l'application
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // 4. Désactiver TOUS les sidebar items
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // 5. FORCER l'activation de l'onglet DEVIS avec délai
                setTimeout(() => {
                    const quotesTab = document.getElementById('quotesTab');
                    const quotesSidebarItem = document.querySelector('[data-tab="quotes"]');
                    
                    if (quotesTab) {
                        quotesTab.classList.add('active');
                        quotesTab.style.display = 'block !important';
                        quotesTab.style.visibility = 'visible !important';
                        quotesTab.style.opacity = '1 !important';
                        console.log('✅ Onglet DEVIS FORCÉ');
                    }
                    
                    if (quotesSidebarItem) {
                        quotesSidebarItem.classList.add('active');
                        console.log('✅ Sidebar DEVIS FORCÉ');
                    }
                }, 50);
                
                // 6. Empêcher tout événement sur newQuoteView
                if (newQuoteView) {
                    newQuoteView.onclick = null;
                    newQuoteView.onmousedown = null;
                    newQuoteView.onmouseup = null;
                    newQuoteView.onmousemove = null;
                }
                
                console.log('🎯 FERMETURE RADICALE TERMINÉE');
            }

            // Tab switching functionality
            function switchTab(tabName) {
                console.log(`🔄 [NAVIGATION] Switching to ${tabName} tab`);
                
                // FORCER LA FERMETURE de la vue nouveau devis si elle est ouverte
                const newQuoteView = document.getElementById('newQuoteView');
                if (newQuoteView && !newQuoteView.classList.contains('hidden')) {
                    console.log('🚫 Fermeture forcée de la vue nouveau devis');
                    // Fermer la vue nouveau devis
                    newQuoteView.classList.add('hidden');
                    newQuoteView.style.display = 'none !important';
                    newQuoteView.style.visibility = 'hidden !important';
                    newQuoteView.style.opacity = '0 !important';
                    newQuoteView.style.zIndex = '-9999 !important';
                    newQuoteView.style.position = 'absolute !important';
                    newQuoteView.style.left = '-9999px !important';
                    newQuoteView.style.top = '-9999px !important';
                }
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remove active from sidebar items
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Show selected tab
                const targetTab = document.getElementById(tabName + 'Tab');
                if (targetTab) {
                    targetTab.classList.add('active');
                    console.log(`✅ Onglet ${tabName} activé`);
                }
                
                // Add active to clicked sidebar item
                const sidebarItem = document.querySelector(`[data-tab="${tabName}"]`);
                if (sidebarItem) {
                    sidebarItem.classList.add('active');
                    console.log(`✅ Sidebar ${tabName} activé`);
                }
            }
            
            // Setup tab navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = e.currentTarget.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Window controls
            const minimizeBtn = document.getElementById('minimizeBtn');
            const maximizeBtn = document.getElementById('maximizeBtn');
            const closeBtn = document.getElementById('closeBtn');
            
            if (minimizeBtn) {
                minimizeBtn.addEventListener('click', () => {
                    if (window.electronAPI) window.electronAPI.minimizeWindow();
                });
            }
            
            if (maximizeBtn) {
                maximizeBtn.addEventListener('click', () => {
                    if (window.electronAPI) window.electronAPI.maximizeWindow();
                });
            }
            
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    if (window.electronAPI) window.electronAPI.closeWindow();
                });
            }
            
            // Logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    console.log('🚪 [LOGOUT] Déconnexion...');
                    
                    if (window.authService && typeof window.authService.signOut === 'function') {
                        await window.authService.signOut();
                    }
                    
                    if (window.electronAPI && typeof window.electronAPI.showLogin === 'function') {
                        window.electronAPI.showLogin();
                    }
                });
            }
            
            console.log('✅ [MAIN WINDOW] Navigation initialisée');
            
            // Configuration de la création de devis
            setupQuoteCreation();
            
            function setupQuoteCreation() {
                console.log('🔄 Configuration de la création de devis...');
                
                // UNIQUEMENT LA VUE PLEIN ÉCRAN - ANCIENNE MODAL SUPPRIMÉE
                const createQuoteBtn = document.getElementById('createQuoteBtn');
                const addServiceBtn = document.getElementById('addServiceBtn');
                
                console.log('🔍 Éléments trouvés:', {
                    createQuoteBtn: !!createQuoteBtn,
                    addServiceBtn: !!addServiceBtn,
                    quoteManager: !!window.quoteManager
                });
                
                // Ouvrir la vue création de devis (pleine page)
                if (createQuoteBtn) {
                    console.log('✅ Ajout du listener sur le bouton Nouveau Devis');
                    createQuoteBtn.addEventListener('click', () => {
                        console.log('📝 Ouverture de la vue création de devis');
                        
                        // Afficher la vue création de devis en plein écran
                        const newQuoteView = document.getElementById('newQuoteView');
                        if (newQuoteView) {
                            console.log('✅ Vue newQuoteView trouvée, ouverture...');
                            newQuoteView.classList.remove('hidden');
                            
                            // FORCER LES STYLES POUR PRENDRE TOUT L'ÉCRAN
                            newQuoteView.style.position = 'fixed';
                            newQuoteView.style.top = '0';
                            newQuoteView.style.left = '0';
                            newQuoteView.style.right = '0';
                            newQuoteView.style.bottom = '0';
                            newQuoteView.style.width = '100vw';
                            newQuoteView.style.height = '100vh';
                            newQuoteView.style.zIndex = '9999';
                            newQuoteView.style.backgroundColor = '#f3f4f6';
                            newQuoteView.style.overflowY = 'auto';
                            newQuoteView.style.margin = '0';
                            newQuoteView.style.padding = '0';
                            
                            console.log('🎯 Vue forcée en plein écran avec styles JavaScript');
                            
                            // Réinitialiser le formulaire
                            const newQuoteForm = document.getElementById('newQuoteForm');
                            if (newQuoteForm) newQuoteForm.reset();
                            
                            // Définir la date du jour
                            const dateInput = document.getElementById('quoteDate');
                            if (dateInput) {
                                const today = new Date().toISOString().split('T')[0];
                                dateInput.value = today;
                            }
                        }
                    });
                } else {
                    console.error('❌ Bouton createQuoteBtn non trouvé !');
                }
                
                // BOUTON RETOUR - VERSION ULTRA-SIMPLE
                const backToQuotesBtn = document.getElementById('backToQuotesBtn');
                if (backToQuotesBtn) {
                    console.log('🔧 Configuration du bouton retour ultra-simple');
                    
                    // Supprimer tous les anciens event listeners
                    const newBtn = backToQuotesBtn.cloneNode(true);
                    backToQuotesBtn.parentNode.replaceChild(newBtn, backToQuotesBtn);
                    
                    // Fonction de fermeture simple
                    function retourUltraSimple(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('🔙 RETOUR ULTRA-SIMPLE - Fermeture vue devis');
                        closeNewQuoteViewCompletely();
                        return false;
                    }
                    
                    // UN SEUL event listener
                    newBtn.addEventListener('click', retourUltraSimple);
                    
                    // Forcer les styles de cliquabilité (au cas où)
                    newBtn.style.pointerEvents = 'auto';
                    
                    console.log('✅ Bouton retour ultra-simple configuré');
                }
                
                // Supprimer l'ancien event listener global redondant
                
                // AJOUT: Event listener pour la touche ESC pour fermer la vue
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const newQuoteView = document.getElementById('newQuoteView');
                        if (newQuoteView && !newQuoteView.classList.contains('hidden')) {
                            e.preventDefault();
                            console.log('⌨️ TOUCHE ESC - Fermeture vue Nouveau Devis');
                            closeNewQuoteViewCompletely();
                        }
                    }
                });
                
                // Bouton "Ajouter une prestation" - VERSION SANS colonne Total
                const addServiceBtnFullPage = document.getElementById('addServiceBtn');
                if (addServiceBtnFullPage) {
                    console.log('✅ Bouton Ajouter une prestation trouvé et configuré');
                    addServiceBtnFullPage.addEventListener('click', () => {
                        console.log('🔄 Ajout d\'une nouvelle prestation...');
                        const container = document.getElementById('servicesContainerFullPage');
                        if (container) {
                            const newService = document.createElement('div');
                            newService.className = 'flex items-center gap-3 p-3 bg-white rounded-lg border shadow-sm';
                            newService.innerHTML = `
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Description de la prestation</label>
                                    <input type="text" name="service_description[]" placeholder="Décrivez votre prestation..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm" required>
                                </div>
                                <div class="w-16">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Quantité</label>
                                    <input type="number" name="service_quantity[]" min="1" value="1" class="w-full px-2 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-center" required>
                                </div>
                                <div class="w-28">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Prix HT</label>
                                    <input type="number" name="service_price[]" step="0.01" min="0" placeholder="0.00 €" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-right" required>
                                </div>
                                <div class="flex items-end">
                                    <button type="button" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" onclick="this.closest('.flex.items-center').remove(); updateTotal();" title="Supprimer cette prestation">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            `;
                            container.appendChild(newService);
                            
                            // Ajouter les event listeners pour le calcul automatique
                            newService.querySelectorAll('input[name="service_quantity[]"], input[name="service_price[]"]').forEach(input => {
                                input.addEventListener('input', updateTotal);
                            });
                            
                            updateTotal();
                        }
                    });
                }
                
                // Nouveau bouton "Ajouter une prestation" dans la section Notes
                const addServiceBtnBottom = document.getElementById('addServiceBtnBottom');
                if (addServiceBtnBottom) {
                    addServiceBtnBottom.addEventListener('click', () => {
                        const container = document.getElementById('servicesContainerFullPage');
                        if (container) {
                            const newService = document.createElement('div');
                            newService.className = 'flex items-center gap-3 p-3 bg-white rounded-lg border shadow-sm';
                            newService.innerHTML = `
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Description de la prestation</label>
                                    <input type="text" name="service_description[]" placeholder="Décrivez votre prestation..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm" required>
                                </div>
                                <div class="w-16">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Quantité</label>
                                    <input type="number" name="service_quantity[]" min="1" value="1" class="w-full px-2 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-center" required>
                                </div>
                                <div class="w-28">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Prix HT</label>
                                    <input type="number" name="service_price[]" step="0.01" min="0" placeholder="0.00 €" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-right" required>
                                </div>
                                <div class="flex items-end">
                                    <button type="button" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" onclick="this.closest('.flex.items-center').remove(); updateTotal();" title="Supprimer cette prestation">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                                </div>
                            `;
                            container.appendChild(newService);
                            
                            // Ajouter les event listeners pour le calcul automatique
                            newService.querySelectorAll('input[name="service_quantity[]"], input[name="service_price[]"]').forEach(input => {
                                input.addEventListener('input', updateTotal);
                            });
                            
                            updateTotal();
                        }
                    });
                }
                
                // Nouveau bouton "Ajouter une prestation" dans la section Notes
                const addServiceBtnNotes = document.getElementById('addServiceBtnNotes');
                if (addServiceBtnNotes) {
                    console.log('✅ Bouton Ajouter prestation (Notes) trouvé et configuré');
                    addServiceBtnNotes.addEventListener('click', () => {
                        console.log('🔄 Ajout d\'une nouvelle prestation depuis Notes...');
                        const container = document.getElementById('servicesContainerFullPage');
                        if (container) {
                            const newService = document.createElement('div');
                            newService.className = 'flex items-center gap-3 p-3 bg-white rounded-lg border shadow-sm';
                            newService.innerHTML = `
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Description de la prestation</label>
                                    <input type="text" name="service_description[]" placeholder="Décrivez votre prestation..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm" required>
                                </div>
                                <div class="w-16">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Quantité</label>
                                    <input type="number" name="service_quantity[]" min="1" value="1" class="w-full px-2 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-center" required>
                                </div>
                                <div class="w-28">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Prix HT</label>
                                    <input type="number" name="service_price[]" step="0.01" min="0" placeholder="0.00 €" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm text-right" required>
                                </div>
                                <div class="flex items-end">
                                    <button type="button" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors" onclick="this.closest('.flex.items-center').remove(); updateTotal();" title="Supprimer cette prestation">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            `;
                            container.appendChild(newService);
                            
                            // Ajouter les event listeners pour le calcul automatique
                            newService.querySelectorAll('input[name="service_quantity[]"], input[name="service_price[]"]').forEach(input => {
                                input.addEventListener('input', updateTotal);
                            });
                            
                            updateTotal();
                        }
                    });
                }
                
                // Bouton "Enregistrer le Devis" dans la vue pleine page
                const saveQuoteBtnFullPage = document.getElementById('saveQuoteBtn');
                const saveQuoteBtnMain = document.getElementById('saveQuoteBtnMain');
                console.log('🔍 Boutons Enregistrer trouvés:', {saveQuoteBtnFullPage, saveQuoteBtnMain});
                
                // Fonction de sauvegarde commune
                window.handleSaveQuote = async (buttonElement) => {
                    console.log('💾 Clic sur le bouton Enregistrer détecté !');
                    
                    const form = document.getElementById('newQuoteForm');
                    console.log('📋 Formulaire trouvé:', form);
                    
                    if (!form) {
                        console.error('❌ Formulaire non trouvé !');
                        alert('❌ Erreur: Formulaire non trouvé');
                        return;
                    }
                    
                    console.log('🔍 Vérification validité du formulaire...');
                    const isValid = form.checkValidity();
                    console.log('📋 Formulaire valide:', isValid);
                    
                    if (!isValid) {
                        console.warn('⚠️ Formulaire invalide, affichage des erreurs...');
                        form.reportValidity();
                        alert('Veuillez remplir tous les champs obligatoires');
                        return;
                    }
                    
                    console.log('✅ Formulaire valide, début de la sauvegarde...');
                    
                    // Désactiver le bouton pendant le traitement
                    const originalText = buttonElement.textContent;
                    buttonElement.disabled = true;
                    buttonElement.textContent = 'Création en cours...';
                    
                    try {
                        const formData = new FormData(form);
                        const quoteData = {
                            clientName: formData.get('clientName') || 'Client non spécifié',
                            clientEmail: formData.get('clientEmail') || '',
                            clientPhone: formData.get('clientPhone') || '',
                            clientAddress: formData.get('clientAddress') || '',
                            quoteDate: formData.get('quoteDate') || new Date().toISOString().split('T')[0],
                            notes: formData.get('quoteNotes') || '',
                            services: [],
                            createdAt: new Date().toISOString()
                        };
                        
                        // Collecter les services depuis les inputs
                        console.log('📊 Collecte des services...');
                        const serviceInputs = document.querySelectorAll('#servicesContainerFullPage > div');
                        console.log('📊 Nombre de lignes de services trouvées:', serviceInputs.length);
                        
                        serviceInputs.forEach((serviceRow, index) => {
                            const description = serviceRow.querySelector('textarea[name="service_description[]"]')?.value || serviceRow.querySelector('input[name="service_description[]"]')?.value;
                            const quantity = parseFloat(serviceRow.querySelector('input[name="service_quantity[]"]')?.value) || 0;
                            const unit = serviceRow.querySelector('select[name="service_unit[]"]')?.value || '';
                            const price = parseFloat(serviceRow.querySelector('input[name="service_price[]"]')?.value) || 0;
                            
                            console.log(`📊 Service ${index + 1}:`, {
                                description: description?.substring(0, 50) + '...',
                                quantity,
                                unit,
                                price
                            });
                            
                            if (description && description.trim() && quantity > 0 && price > 0) {
                                quoteData.services.push({
                                    description: description.trim(),
                                    quantity: quantity,
                                    unit: unit,
                                    price: price
                                });
                                console.log('✅ Service ajouté à la liste');
                            } else {
                                console.warn('⚠️ Service ignoré - données manquantes');
                            }
                        });
                        
                        console.log('📊 Nombre total de services valides:', quoteData.services.length);
                        
                        if (quoteData.services.length === 0) {
                            throw new Error('Veuillez ajouter au moins une prestation valide');
                        }
                        
                        // Calculer les totaux
                        let totalHT = 0;
                        quoteData.services.forEach(service => {
                            totalHT += service.quantity * service.price;
                        });
                        
                        const totalTVA = totalHT * 0.20; // TVA 20%
                        const totalTTC = totalHT + totalTVA;
                        
                        quoteData.totalHT = totalHT;
                        quoteData.totalTVA = totalTVA;
                        quoteData.totalTTC = totalTTC;
                        
                        console.log('📄 Données du devis:', quoteData);
                        
                        // Sauvegarder en base de données
                        if (window.dbService && typeof window.dbService.createQuote === 'function') {
                            try {
                                const dbResult = await window.dbService.createQuote(quoteData);
                                console.log('✅ Devis sauvegardé en base de données:', dbResult);
                            } catch (dbError) {
                                console.warn('⚠️ Erreur base de données (continuons quand même):', dbError);
                            }
                        }
                        
                        // Générer et télécharger le PDF
                        await generateAndDownloadPDF(quoteData);
                        
                        alert('✅ Devis créé et téléchargé avec succès !');
                        
                        // Fermer la vue après succès
                        closeNewQuoteViewCompletely();
                        
                    } catch (error) {
                        console.error('❌ Erreur lors de la création du devis:', error);
                        alert('❌ Erreur: ' + error.message);
                    } finally {
                        // Réactiver le bouton
                        buttonElement.disabled = false;
                        buttonElement.textContent = originalText;
                    }
                };

                // Configuration des événements pour les deux boutons
                if (saveQuoteBtnFullPage) {
                    console.log('✅ Configuration du bouton Enregistrer (header)...');
                    saveQuoteBtnFullPage.addEventListener('click', () => window.handleSaveQuote(saveQuoteBtnFullPage));
                }

                if (saveQuoteBtnMain) {
                    console.log('✅ Configuration du bouton Enregistrer principal (bas de page)...');
                    saveQuoteBtnMain.addEventListener('click', () => window.handleSaveQuote(saveQuoteBtnMain));
                } else {
                    console.error('❌ Bouton principal d\'enregistrement non trouvé !');
                }
                
                // Fonction pour générer et télécharger le PDF
                async function generateAndDownloadPDF(quoteData) {
                    try {
                        console.log('🔄 Génération du PDF...');
                        
                        // Vérifier que jsPDF est disponible
                        if (typeof window.jsPDF === 'undefined') {
                            console.error('❌ jsPDF non disponible');
                            throw new Error('jsPDF non disponible');
                        }
                        
                        const { jsPDF } = window.jsPDF;
                        const doc = new jsPDF();
                        
                        // Configuration
                        const margin = 20;
                        const pageWidth = doc.internal.pageSize.getWidth();
                        let currentY = margin;
                        
                        // En-tête
                        doc.setFontSize(20);
                        doc.setFont(undefined, 'bold');
                        doc.text('DEVIS', pageWidth / 2, currentY, { align: 'center' });
                        currentY += 15;
                        
                        // Numéro de devis
                        const quoteNumber = 'DEV-' + new Date().getFullYear() + '-' + String(Date.now()).slice(-6);
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'normal');
                        doc.text(`Numéro: ${quoteNumber}`, margin, currentY);
                        doc.text(`Date: ${quoteData.quoteDate || new Date().toLocaleDateString('fr-FR')}`, pageWidth - margin, currentY, { align: 'right' });
                        currentY += 20;
                        
                        // Informations client
                        doc.setFont(undefined, 'bold');
                        doc.text('CLIENT:', margin, currentY);
                        doc.setFont(undefined, 'normal');
                        currentY += 8;
                        
                        const clientInfo = [
                            quoteData.clientName || 'Client non spécifié',
                            quoteData.clientAddress || '',
                            quoteData.clientPhone || '',
                            quoteData.clientEmail || ''
                        ].filter(line => line);
                        
                        clientInfo.forEach(line => {
                            doc.text(line, margin, currentY);
                            currentY += 6;
                        });
                        
                        currentY += 10;
                        
                        // Tableau des prestations
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text('PRESTATIONS:', margin, currentY);
                        currentY += 10;
                        
                        // En-têtes du tableau
                        const colWidths = [70, 20, 25, 30, 40];
                        const colPositions = [margin, margin + colWidths[0], margin + colWidths[0] + colWidths[1], margin + colWidths[0] + colWidths[1] + colWidths[2], margin + colWidths[0] + colWidths[1] + colWidths[2] + colWidths[3]];
                        
                        doc.setFont(undefined, 'bold');
                        doc.text('Description', colPositions[0], currentY);
                        doc.text('Qté', colPositions[1], currentY);
                        doc.text('Unité', colPositions[2], currentY);
                        doc.text('Prix HT', colPositions[3], currentY);
                        doc.text('Total HT', colPositions[4], currentY);
                        currentY += 8;
                        
                        // Ligne de séparation
                        doc.line(margin, currentY, pageWidth - margin, currentY);
                        currentY += 5;
                        
                        // Prestations
                        doc.setFont(undefined, 'normal');
                        quoteData.services.forEach(service => {
                            const total = service.quantity * service.price;
                            doc.text(service.description, colPositions[0], currentY);
                            doc.text(service.quantity.toString(), colPositions[1], currentY);
                            doc.text(service.unit || '', colPositions[2], currentY);
                            doc.text(service.price.toFixed(2) + ' €', colPositions[3], currentY);
                            doc.text(total.toFixed(2) + ' €', colPositions[4], currentY);
                            currentY += 8;
                        });
                        
                        // Ligne de séparation
                        currentY += 5;
                        doc.line(margin, currentY, pageWidth - margin, currentY);
                        currentY += 10;
                        
                        // Totaux
                        doc.setFont(undefined, 'bold');
                        const totalsX = pageWidth - 80;
                        doc.text(`Total HT: ${quoteData.totalHT.toFixed(2)} €`, totalsX, currentY);
                        currentY += 8;
                        doc.text(`TVA (20%): ${quoteData.totalTVA.toFixed(2)} €`, totalsX, currentY);
                        currentY += 8;
                        doc.setFontSize(14);
                        doc.text(`Total TTC: ${quoteData.totalTTC.toFixed(2)} €`, totalsX, currentY);
                        
                        // Notes
                        if (quoteData.notes && quoteData.notes.trim()) {
                            currentY += 20;
                            doc.setFontSize(12);
                            doc.setFont(undefined, 'bold');
                            doc.text('NOTES:', margin, currentY);
                            currentY += 8;
                            doc.setFont(undefined, 'normal');
                            const noteLines = doc.splitTextToSize(quoteData.notes, pageWidth - 2 * margin);
                            doc.text(noteLines, margin, currentY);
                        }
                        
                        // Télécharger le PDF
                        const filename = `devis-${quoteNumber}-${new Date().toISOString().split('T')[0]}.pdf`;
                        doc.save(filename);
                        
                        console.log('✅ PDF généré et téléchargé:', filename);
                        return { success: true, filename, quoteNumber };
                        
                    } catch (error) {
                        console.error('❌ Erreur génération PDF:', error);
                        throw new Error('Erreur lors de la génération du PDF: ' + error.message);
                    }
                }
                
                // Fonction pour mettre à jour le total
                window.updateTotal = function() {
                    let totalHT = 0;
                    
                    document.querySelectorAll('#servicesContainerFullPage > div').forEach(serviceRow => {
                        const quantity = parseFloat(serviceRow.querySelector('input[name="service_quantity[]"]')?.value) || 0;
                        const price = parseFloat(serviceRow.querySelector('input[name="service_price[]"]')?.value) || 0;
                        totalHT += quantity * price;
                    });
                    
                    const tva = totalHT * 0.20;
                    const totalTTC = totalHT + tva;
                    
                    document.getElementById('totalAmount').textContent = totalHT.toFixed(2) + ' €';
                    document.getElementById('taxAmount').textContent = tva.toFixed(2) + ' €';
                    document.getElementById('totalAmountTTC').textContent = totalTTC.toFixed(2) + ' €';
                };
                
                // Ajouter les event listeners pour le calcul automatique sur les champs existants
                document.querySelectorAll('#servicesContainerFullPage input[name="service_quantity[]"], #servicesContainerFullPage input[name="service_price[]"]').forEach(input => {
                    input.addEventListener('input', updateTotal);
                });
            }
        });
        
        // FONCTION setupQuoteCreation DUPLIQUÉE SUPPRIMÉE
        // Une seule version existe maintenant pour éviter les conflits
        
        // Classe QuoteManager pour gérer les devis
        class QuoteManager {
            constructor() {
                this.services = [];
                this.currentQuote = null;
            }
            
            // Calculer les totaux
            calculateTotals() {
                let totalHT = 0;
                
                document.querySelectorAll('.service-item').forEach(item => {
                    const quantity = parseFloat(item.querySelector('.service-quantity').value) || 0;
                    const price = parseFloat(item.querySelector('.service-price').value) || 0;
                    totalHT += quantity * price;
                });
                
                const totalTVA = totalHT * 0.20; // TVA 20%
                const totalTTC = totalHT + totalTVA;
                
                document.getElementById('totalHT').textContent = totalHT.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('totalTVA').textContent = totalTVA.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('totalTTC').textContent = totalTTC.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                
                return { totalHT, totalTVA, totalTTC };
            }
            
            // Ajouter une prestation
            addService() {
                const container = document.getElementById('servicesContainer');
                
                const serviceHTML = `
                    <div class="service-item bg-gray-50 p-4 rounded-lg mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                                <input type="text" class="service-description w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Description de la prestation" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Quantité *</label>
                                <input type="number" class="service-quantity w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="1" min="1" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Prix unitaire HT *</label>
                                <input type="number" class="service-price w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" step="0.01" min="0" placeholder="0.00" required>
                            </div>
                            <div class="flex items-end">
                                <button type="button" class="remove-service-btn w-full bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg font-medium transition-colors">
                                    Supprimer
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', serviceHTML);
                this.setupServiceEventListeners();
                this.calculateTotals();
            }
            
            // Supprimer une prestation
            removeService(serviceElement) {
                const container = document.getElementById('servicesContainer');
                if (container.children.length > 1) {
                    serviceElement.remove();
                    this.calculateTotals();
                }
            }
            
            // Configurer les event listeners pour les prestations
            setupServiceEventListeners() {
                // Calculer les totaux quand les valeurs changent
                document.querySelectorAll('.service-quantity, .service-price').forEach(input => {
                    input.removeEventListener('input', this.calculateTotals.bind(this));
                    input.addEventListener('input', this.calculateTotals.bind(this));
                });
                
                // Supprimer une prestation
                document.querySelectorAll('.remove-service-btn').forEach(btn => {
                    btn.removeEventListener('click', this.handleRemoveService.bind(this));
                    btn.addEventListener('click', this.handleRemoveService.bind(this));
                });
            }
            
            handleRemoveService(e) {
                const serviceItem = e.target.closest('.service-item');
                this.removeService(serviceItem);
            }
            
            // Générer le PDF du devis
            async generatePDF(quoteData) {
                console.log('🔄 Génération du PDF...', quoteData);
                
                // Vérifier que jsPDF est disponible
                if (typeof window.jsPDF === 'undefined') {
                    console.error('❌ jsPDF non disponible');
                    alert('Erreur: La bibliothèque de génération PDF n\'est pas disponible.');
                    return;
                }
                
                try {
                    const { jsPDF } = window.jsPDF;
                    const doc = new jsPDF();
                    
                    // Configuration
                    const pageWidth = doc.internal.pageSize.width;
                    const pageHeight = doc.internal.pageSize.height;
                    const margin = 20;
                    let currentY = margin;
                    
                    // Couleurs
                    const primaryColor = [37, 99, 235]; // Blue-600
                    const textColor = [55, 65, 81]; // Gray-700
                    const lightGray = [243, 244, 246]; // Gray-100
                    
                    // En-tête
                    doc.setFontSize(24);
                    doc.setTextColor(...primaryColor);
                    doc.text('DEVIS', pageWidth / 2, currentY, { align: 'center' });
                    currentY += 15;
                    
                    // Numéro de devis et date
                    doc.setFontSize(12);
                    doc.setTextColor(...textColor);
                    const quoteNumber = 'DEVIS-' + Date.now().toString().slice(-6);
                    const quoteDate = new Date().toLocaleDateString('fr-FR');
                    
                    doc.text(`Numéro: ${quoteNumber}`, margin, currentY);
                    doc.text(`Date: ${quoteDate}`, pageWidth - margin, currentY, { align: 'right' });
                    currentY += 20;
                    
                    // Informations entreprise (à gauche)
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text('DE :', margin, currentY);
                    doc.setFont(undefined, 'normal');
                    currentY += 6;
                    
                    const companyInfo = [
                        'Mon Entreprise',
                        '123 Rue Example',
                        '75000 Paris',
                        'Tel: 01 23 45 67 89',
                        'Email: contact@monentreprise.fr'
                    ];
                    
                    companyInfo.forEach(line => {
                        doc.text(line, margin, currentY);
                        currentY += 5;
                    });
                    
                    // Informations client (à droite)
                    currentY = margin + 35; // Réinitialiser Y pour aligner avec l'entreprise
                    doc.setFont(undefined, 'bold');
                    doc.text('POUR :', pageWidth / 2 + 10, currentY);
                    doc.setFont(undefined, 'normal');
                    currentY += 6;
                    
                    const clientInfo = [
                        quoteData.clientName || 'Client non spécifié',
                        quoteData.clientAddress || '',
                        quoteData.clientPhone || '',
                        quoteData.clientEmail || ''
                    ].filter(line => line); // Supprimer les lignes vides
                    
                    clientInfo.forEach(line => {
                        doc.text(line, pageWidth / 2 + 10, currentY);
                        currentY += 5;
                    });
                    
                    currentY = Math.max(currentY, margin + 70); // S'assurer qu'on a assez d'espace
                    
                    // Tableau des prestations
                    currentY += 10;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('PRESTATIONS', margin, currentY);
                    currentY += 10;
                    
                    // En-têtes du tableau
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    const headers = ['Description', 'Qté', 'Prix unit. HT', 'Total HT'];
                    const colWidths = [100, 20, 30, 30];
                    let currentX = margin;
                    
                    // Dessiner les en-têtes
                    doc.setFillColor(...lightGray);
                    doc.rect(margin, currentY - 5, pageWidth - 2 * margin, 10, 'F');
                    
                    headers.forEach((header, index) => {
                        doc.text(header, currentX + 2, currentY);
                        currentX += colWidths[index];
                    });
                    currentY += 10;
                    
                    // Lignes du tableau
                    doc.setFont(undefined, 'normal');
                    let totalHT = 0;
                    
                    quoteData.services.forEach((service, index) => {
                        const lineTotal = service.quantity * service.price;
                        totalHT += lineTotal;
                        
                        currentX = margin;
                        const values = [
                            service.description,
                            service.quantity.toString(),
                            service.price.toFixed(2) + ' €',
                            lineTotal.toFixed(2) + ' €'
                        ];
                        
                        // Dessiner ligne alternée
                        if (index % 2 === 1) {
                            doc.setFillColor(248, 250, 252); // Gray-50
                            doc.rect(margin, currentY - 5, pageWidth - 2 * margin, 8, 'F');
                        }
                        
                        values.forEach((value, colIndex) => {
                            if (colIndex === 0) {
                                // Description - peut être longue
                                const lines = doc.splitTextToSize(value, colWidths[colIndex] - 4);
                                doc.text(lines, currentX + 2, currentY);
                            } else {
                                // Autres colonnes - alignement à droite
                                doc.text(value, currentX + colWidths[colIndex] - 2, currentY, { align: 'right' });
                            }
                            currentX += colWidths[colIndex];
                        });
                        
                        currentY += 8;
                    });
                    
                    // Totaux
                    currentY += 10;
                    const totalTVA = totalHT * 0.20;
                    const totalTTC = totalHT + totalTVA;
                    
                    doc.setFont(undefined, 'bold');
                    const totalsX = pageWidth - margin - 60;
                    
                    doc.text('Total HT :', totalsX - 30, currentY);
                    doc.text(totalHT.toFixed(2) + ' €', totalsX, currentY, { align: 'right' });
                    currentY += 7;
                    
                    doc.text('TVA (20%) :', totalsX - 30, currentY);
                    doc.text(totalTVA.toFixed(2) + ' €', totalsX, currentY, { align: 'right' });
                    currentY += 7;
                    
                    doc.setFontSize(12);
                    doc.text('Total TTC :', totalsX - 30, currentY);
                    doc.text(totalTTC.toFixed(2) + ' €', totalsX, currentY, { align: 'right' });
                    
                    // Notes
                    if (quoteData.notes && quoteData.notes.trim()) {
                        currentY += 20;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'bold');
                        doc.text('Notes :', margin, currentY);
                        currentY += 6;
                        
                        doc.setFont(undefined, 'normal');
                        const noteLines = doc.splitTextToSize(quoteData.notes, pageWidth - 2 * margin);
                        doc.text(noteLines, margin, currentY);
                    }
                    
                    // Pied de page
                    currentY = pageHeight - 40;
                    doc.setFontSize(8);
                    doc.setTextColor(128, 128, 128);
                    doc.text('Devis valable 30 jours à compter de la date d\'émission', pageWidth / 2, currentY, { align: 'center' });
                    currentY += 5;
                    doc.text('Conditions de paiement : 30 jours net', pageWidth / 2, currentY, { align: 'center' });
                    
                    // Sauvegarder le PDF
                    const filename = `Devis_${quoteNumber}_${quoteData.clientName.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
                    doc.save(filename);
                    
                    console.log('✅ PDF généré et téléchargé:', filename);
                    return { filename, quoteNumber, totalTTC };
                    
                } catch (error) {
                    console.error('❌ Erreur lors de la génération du PDF:', error);
                    throw error;
                }
            }
            
            // Créer un devis
            async createQuote(formData) {
                try {
                    console.log('🔄 Création du devis...', formData);
                    
                    // Préparer les données du devis
                    const quoteData = {
                        clientName: formData.get('clientName'),
                        clientEmail: formData.get('clientEmail'),
                        clientPhone: formData.get('clientPhone'),
                        clientAddress: formData.get('clientAddress'),
                        notes: formData.get('notes'),
                        services: [],
                        createdAt: new Date().toISOString()
                    };
                    
                    // Collecter les prestations
                    document.querySelectorAll('.service-item').forEach(item => {
                        const description = item.querySelector('.service-description').value;
                        const quantity = parseFloat(item.querySelector('.service-quantity').value) || 0;
                        const price = parseFloat(item.querySelector('.service-price').value) || 0;
                        
                        if (description && quantity > 0 && price > 0) {
                            quoteData.services.push({
                                description,
                                quantity,
                                price
                            });
                        }
                    });
                    
                    if (quoteData.services.length === 0) {
                        throw new Error('Veuillez ajouter au moins une prestation');
                    }
                    
                    // Calculer les totaux
                    const totals = this.calculateTotals();
                    quoteData.totalHT = totals.totalHT;
                    quoteData.totalTVA = totals.totalTVA;
                    quoteData.totalTTC = totals.totalTTC;
                    
                    // Sauvegarder en base de données (si connecté)
                    if (window.dbService && typeof window.dbService.createQuote === 'function') {
                        try {
                            await window.dbService.createQuote(quoteData);
                            console.log('✅ Devis sauvegardé en base de données');
                        } catch (error) {
                            console.warn('⚠️ Erreur lors de la sauvegarde en base:', error);
                        }
                    }
                    
                    // Générer et télécharger le PDF
                    const result = await this.generatePDF(quoteData);
                    
                    return {
                        success: true,
                        message: `Devis ${result.quoteNumber} créé et téléchargé avec succès !`,
                        data: quoteData,
                        filename: result.filename
                    };
                    
                } catch (error) {
                    console.error('❌ Erreur lors de la création du devis:', error);
                    return {
                        success: false,
                        message: error.message || 'Erreur lors de la création du devis'
                    };
                }
            }
        }
        
        // Instance globale du QuoteManager
        window.quoteManager = new QuoteManager();
        
        // Configuration de la création de devis - VERSION CORRIGÉE
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔄 Configuration finale de la création de devis...');
            
            // UNIQUEMENT LA VUE PLEIN ÉCRAN - ANCIENNE MODAL SUPPRIMÉE
            const createQuoteBtn = document.getElementById('createQuoteBtn');
            const addServiceBtn = document.getElementById('addServiceBtn');
            
            console.log('🔍 Éléments trouvés:', {
                createQuoteBtn: !!createQuoteBtn,
                addServiceBtn: !!addServiceBtn,
                quoteManager: !!window.quoteManager
            });
            
            // Configuration finale - s'assurer que seule la vue plein écran est utilisée
            if (createQuoteBtn) {
                console.log('✅ Configuration finale du bouton Nouveau Devis');
                createQuoteBtn.addEventListener('click', () => {
                    console.log('📝 Ouverture FINALE de la vue création de devis');
                    
                    // Masquer toute modal existante (si elle existait encore)
                    const anyModal = document.getElementById('quoteModal');
                    if (anyModal) anyModal.classList.add('hidden');
                    
                    // Afficher uniquement la vue création de devis en plein écran
                    const newQuoteView = document.getElementById('newQuoteView');
                    if (newQuoteView) {
                        newQuoteView.classList.remove('hidden');
                        
                        // FORCER LES STYLES POUR PRENDRE TOUT L'ÉCRAN
                        newQuoteView.style.position = 'fixed';
                        newQuoteView.style.top = '0';
                        newQuoteView.style.left = '0';
                        newQuoteView.style.right = '0';
                        newQuoteView.style.bottom = '0';
                        newQuoteView.style.width = '100vw';
                        newQuoteView.style.height = '100vh';
                        newQuoteView.style.zIndex = '9999';
                        newQuoteView.style.backgroundColor = '#f3f4f6';
                        newQuoteView.style.overflowY = 'auto';
                        newQuoteView.style.margin = '0';
                        newQuoteView.style.padding = '0';
                        
                        console.log('🎯 Vue FINALE forcée en plein écran');
                        
                        // Réinitialiser le formulaire
                        const newQuoteForm = document.getElementById('newQuoteForm');
                        if (newQuoteForm) newQuoteForm.reset();
                        
                        // Définir la date du jour
                        const dateInput = document.getElementById('quoteDate');
                        if (dateInput) {
                            const today = new Date().toISOString().split('T')[0];
                            dateInput.value = today;
                        }
                        
                        // Configurer les event listeners
                        if (window.quoteManager) {
                            window.quoteManager.setupServiceEventListeners();
                            window.quoteManager.calculateTotals();
                        }
                    }
                });
            } else {
                console.error('❌ Bouton createQuoteBtn non trouvé !');
            }
            
            // ANCIENNE LOGIQUE MODAL COMPLÈTEMENT SUPPRIMÉE
            console.log('✅ Configuration FINALE terminée - uniquement vue plein écran');
        });
    </script>
</body>
</html>